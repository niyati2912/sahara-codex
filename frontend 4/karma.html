<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SAHARA ‚Äì Karma & Help Verification (Demo)</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-a: #f7fbff;          /* baby blue */
      --bg-b: #fffbe6;          /* pastel yellow */
      --bg-c: #e9fff3;          /* mint */
      --ink: #174a5b;           /* soft navy */
      --primary: #3aa6b9;       /* calm teal */
      --primary-600:#2f8a9a;
      --success: #38b46e;       /* soft green */
      --danger: #ff6b6b;        /* soft red */
      --card: rgba(255,255,255,0.8);
      --shadow: 0 10px 30px rgba(23, 74, 91, 0.10);
      --radius: 18px;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:'Poppins',sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at -10% -10%, var(--bg-c), transparent 60%),
        radial-gradient(1000px 700px at 110% -20%, var(--bg-b), transparent 60%),
        linear-gradient(135deg, var(--bg-a), #eef8ff 60%);
      display:flex;flex-direction:column;min-height:100vh;
    }

    header{
      padding:22px 16px; text-align:center;
      position:sticky; top:0; backdrop-filter:saturate(180%) blur(8px);
      background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.4));
      border-bottom:1px solid rgba(58,166,185,0.15);
      z-index:50;
    }
    .title{font-size:1.6rem;font-weight:700;letter-spacing:0.3px}
    .subtitle{font-size:.95rem;opacity:.85}

    main{width:100%;max-width:1100px;margin:22px auto;flex:1;padding:0 14px 40px}

    .topbar{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin:14px 0 24px}
    .profile-card{
      flex:1; min-width:260px; background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:16px 18px; display:flex; align-items:center; gap:14px
    }
    .avatar{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg,var(--bg-c),#d9fff0);display:flex;align-items:center;justify-content:center;font-weight:700}
    .profile-meta b{display:block;font-size:1rem}
    .profile-meta small{opacity:.8}

    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer;box-shadow:var(--shadow);transition:transform .06s ease, box-shadow .2s}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-ghost{background:#ffffffb8}
    .btn-success{background:var(--success);color:#fff}
    .btn-danger{background:var(--danger);color:#fff}

    /* Toggle */
    .toggle{
      display:flex; background:#ffffffc5; padding:6px; border-radius:14px; box-shadow:var(--shadow); gap:6px; width:100%; max-width:420px; margin:0 auto 18px
    }
    .toggle button{flex:1;padding:10px 12px;border-radius:10px;border:0;font-weight:700;cursor:pointer;background:transparent}
    .toggle button.active{background:linear-gradient(180deg,#fff, #f6fffb); box-shadow:0 6px 18px rgba(58,166,185,.18)}

    /* Panels */
    .grid{display:grid;grid-template-columns:1fr;gap:18px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}

    .card{background:var(--card);backdrop-filter:blur(10px);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .card h2{font-size:1.2rem;margin-bottom:12px;color:var(--primary-600)}

    .form-group{margin:10px 0}
    label{display:block;margin-bottom:6px;font-weight:600}
    input, select, textarea{width:100%;padding:11px 12px;border:1px solid rgba(58,166,185,.25);border-radius:12px;background:#fff;font-size:0.98rem}
    textarea{resize:vertical;min-height:96px}

    .radio-row{display:flex;gap:16px;margin:6px 0 0}
    .radio-row label{font-weight:500}

    .muted{font-size:.92rem;opacity:.8}

    .section-divider{height:1px;background:linear-gradient(90deg,transparent,rgba(58,166,185,.25),transparent);margin:14px 0}

    /* toast */
    .toast{position:fixed;right:18px;bottom:18px;background:#ffffffee;border:1px solid rgba(23,74,91,.12);box-shadow:var(--shadow);padding:14px 16px;border-radius:14px;display:none;max-width:320px;z-index:200}
    .toast.show{display:block}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(23,74,91,.15);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:300}
    .modal{width:95%;max-width:520px;background:var(--card);padding:18px;border-radius:18px;box-shadow:var(--shadow)}
    .modal h3{margin-bottom:8px;color:var(--primary-600)}
    .modal .row{display:flex;gap:10px}
    .modal .row .col{flex:1}

    footer{margin:18px auto 28px; text-align:center; font-size:.92rem; opacity:.9}

    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#fffbe680;border:1px solid #f3e7a1;font-size:.85rem;margin-right:6px}
    .status-wait{background:#fffbe6;border-color:#f3e7a1}
    .status-ok{background:#eafff2;border-color:#b8f0cd}
    .status-no{background:#ffeaea;border-color:#ffc0c0}

    .hidden{display:none !important}
  </style>
</head>
<body>
  <header>
    <div class="title">SAHARA ‚Äì Lifeline Karma</div>
    <div class="subtitle">Soft, trustable community help ‚Ä¢ Demo-ready for jury & investors</div>
  </header>

  <main>

    <div class="topbar">
      <div class="profile-card" id="volProfile">
        <div class="avatar">üë§</div>
        <div class="profile-meta">
          <b id="volName">Guest Volunteer</b>
          <small><span id="volId">N/A</span> ‚Ä¢ Karma: <span id="volKarma">0</span></small>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-ghost" id="switchAccountBtn">Switch Volunteer</button>
        <button class="btn btn-ghost" id="switchReceiverBtn">Switch Receiver</button>
        <button class="btn btn-primary" id="quickDemoBtn">Quick Demo</button>
      </div>
    </div>

    <!-- Mode toggle -->
    <div class="toggle" role="tablist" aria-label="Mode Toggle">
      <button id="tabEarn" class="active" role="tab" aria-selected="true">Earn Karma (Volunteer)</button>
      <button id="tabVerify" role="tab" aria-selected="false">Verify Help (Receiver)</button>
    </div>

    <!-- Panels -->
    <section id="panelEarn" class="grid" role="tabpanel" aria-labelledby="tabEarn">

      <div class="card">
        <h2>Task You Completed</h2>
        <div class="form-group">
          <label for="taskName">Task Name</label>
          <input type="text" id="taskName" placeholder="Eg. Assisted with medical aid">
        </div>
        <div class="form-group">
          <label for="location">Task Location</label>
          <input type="text" id="location" placeholder="Eg. AIIMS Gate 3, Delhi">
        </div>
        <div class="form-group">
          <label>Was the situation urgent?</label>
          <div class="radio-row">
            <label><input type="radio" name="urgent" value="Yes"> Yes</label>
            <label><input type="radio" name="urgent" value="No"> No</label>
          </div>
        </div>
        <div class="form-group">
          <label for="hours">Approximate Hours Spent</label>
          <select id="hours">
            <option>1-2 hours</option>
            <option>2-4 hours</option>
            <option>More than 4 hours</option>
          </select>
        </div>
        <div class="form-group">
          <label for="summary">Brief Summary of Task</label>
          <textarea id="summary" rows="4" placeholder="Describe what you did..."></textarea>
        </div>
        <button class="btn btn-primary" id="btnSubmitTask">Submit Task</button>
      </div>

      <div class="card" id="cardNextStep" style="display:none;">
        <h2>‚úÖ Task Recorded</h2>
        <p class="muted">Now add details of the person you helped so they can verify.</p>
        <div class="section-divider"></div>
        <div class="form-group">
          <label for="personName">Person's Full Name</label>
          <input type="text" id="personName" placeholder="Eg. Ramesh Kumar">
        </div>
        <div class="form-group">
          <label for="personContact">Contact Number / ID</label>
          <input type="text" id="personContact" placeholder="Phone / Aadhaar / SAHARA ID">
        </div>
        <div class="form-group">
          <label for="helpType">Help Provided</label>
          <select id="helpType">
            <option>Medical Aid</option>
            <option>Emotional Support</option>
            <option>Safety Assistance</option>
            <option>Technical Help</option>
            <option>Lost & Stranded</option>
            <option>Women/LGBTQ+ Safety</option>
          </select>
        </div>
        <button class="btn btn-primary" id="btnSubmitPerson">Submit Person Details</button>
      </div>

      <div class="card" id="cardAwait" style="display:none;">
        <h2>‚è≥ Awaiting Verification</h2>
        <p class="muted">We have notified the receiver. You'll be alerted here once they respond.</p>
        <div class="pill status-wait">Status: Waiting for receiver response</div>
      </div>

      <div class="card" id="cardAward" style="display:none;">
        <h2>üéâ Verification Received</h2>
        <p class="muted">The receiver has responded. Accept to claim your karma.</p>
        <div id="verifyMessage" class="pill status-ok" style="margin-bottom:10px">Verified by receiver</div>
        <div class="actions">
          <button class="btn btn-success" id="btnAcceptKarma">OK, award +100 karma</button>
          <button class="btn btn-ghost" id="btnLater">I'll respond later</button>
        </div>
      </div>

    </section>

    <section id="panelVerify" class="grid hidden" role="tabpanel" aria-labelledby="tabVerify">

      <div class="card" id="receiverLoginCard">
        <h2>Quick Receiver Login</h2>
        <p class="muted">Anyone can log in for demo. Your name helps personalize the experience.</p>
        <div class="form-group">
          <label for="rcvName">Your Name</label>
          <input type="text" id="rcvName" placeholder="Eg. Ramesh Kumar">
        </div>
        <div class="form-group">
          <label for="rcvId">Your ID (Phone / SAHARA-ID)</label>
          <input type="text" id="rcvId" placeholder="Eg. +91XXXXXXXXXX or SAHARA-USER-001">
        </div>
        <button class="btn btn-primary" id="btnReceiverLogin">Continue</button>
      </div>

      <div class="card hidden" id="verifyFormCard">
        <h2>Help Received Verification</h2>
        <div class="form-group">
          <label for="helperId">Helper's Volunteer ID</label>
          <input type="text" id="helperId" placeholder="Eg. SAHARA-2025-014">
        </div>
        <div class="form-group">
          <label for="helperName">Helper's Name</label>
          <input type="text" id="helperName" placeholder="Eg. Aanya Mehra">
        </div>
        <div class="form-group">
          <label for="verifyLocation">Location</label>
          <input type="text" id="verifyLocation" placeholder="Eg. Pune Station">
        </div>
        <div class="form-group">
          <label for="verifyTask">What did they do?</label>
          <textarea id="verifyTask" placeholder="Provided insulin and stayed till ambulance arrived"></textarea>
        </div>
        <div class="actions">
          <button class="btn btn-success" id="btnConfirmYes">Yes, they helped me</button>
          <button class="btn btn-danger" id="btnConfirmNo">No, I didn't receive this</button>
        </div>
      </div>

      <div class="card hidden" id="receiverThanksCard">
        <h2>Thank You üíö</h2>
        <p id="receiverMsg" class="muted">Your response has been sent. The helper will be notified.</p>
        <div id="receiverStatus" class="pill status-ok">Status: Help verified</div>
      </div>

    </section>

    <footer id="footerInfo">¬© 2025 SAHARA Community ‚Ä¢ Demo Build</footer>
  </main>

  <!-- Toast -->
  <div class="toast" id="toast"><span id="toastText">Notification</span></div>

  <!-- Modal (generic) -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal">
      <h3 id="modalTitle">Modal</h3>
      <p id="modalBody" class="muted" style="margin:6px 0 12px"></p>
      <div class="row">
        <div class="col"><button class="btn btn-ghost" id="modalCancel">Cancel</button></div>
        <div class="col"><button class="btn btn-primary" id="modalOk">OK</button></div>
      </div>
    </div>
  </div>

  <script>
    // ===== Utility: LocalStorage wrappers =====
    const store = {
      get(key, fallback){
        try{ return JSON.parse(localStorage.getItem(key)) ?? fallback }catch(e){ return fallback }
      },
      set(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
    };

    // ===== Models =====
    // Volunteer user
    function getUser(){
      return store.get('user', null);
    }
    function setUser(u){ store.set('user', u); renderVolunteerProfile(); }

    // Receiver user
    function getReceiver(){ return store.get('receiver', null); }
    function setReceiver(r){ store.set('receiver', r); renderFooter(); }

    // ===== UI elements =====
    const el = (id)=>document.getElementById(id);

    function toast(text, timeout=2500){
      el('toastText').textContent = text;
      const t = el('toast');
      t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), timeout);
    }

    function showModal(title, body, onOk, onCancel){
      el('modalTitle').textContent = title;
      el('modalBody').textContent = body;
      const backdrop = el('modalBackdrop');
      backdrop.style.display = 'flex';
      const ok = el('modalOk');
      const cancel = el('modalCancel');

      function cleanup(){
        backdrop.style.display = 'none';
        ok.onclick = null; cancel.onclick = null;
      }
      ok.onclick = ()=>{ cleanup(); onOk && onOk(); };
      cancel.onclick = ()=>{ cleanup(); onCancel && onCancel(); };
    }

    // ===== Rendering =====
    function renderVolunteerProfile(){
      const user = getUser();
      const name = user?.name || 'Guest Volunteer';
      const id = user?.id || 'N/A';
      const karma = user?.karma ?? 0;
      el('volName').textContent = name;
      el('volId').textContent = id;
      el('volKarma').textContent = karma;
      renderFooter();
    }

    function renderFooter(){
      const user = getUser();
      const receiver = getReceiver();
      const parts = [];
      if(user) parts.push(`Volunteer: ${user.name} (${user.id}) ‚Ä¢ Karma: ${user.karma}`);
      if(receiver) parts.push(`Receiver: ${receiver.name} (${receiver.id})`);
      el('footerInfo').textContent = parts.length ? `¬© 2025 SAHARA ‚Ä¢ ${parts.join('  |  ')}` : '¬© 2025 SAHARA Community ‚Ä¢ Demo Build';
    }

    // ===== Login helpers =====
    function ensureVolunteer(){
      let user = getUser();
      if(!user){
        // quick inline login
        const name = prompt('Enter volunteer name (demo):', 'Aanya Mehra');
        const id = prompt('Enter volunteer ID (demo):', 'SAHARA-2025-014');
        user = { name: name||'Volunteer', id: id||('SAHARA-'+Math.floor(Math.random()*9999)), karma: 0 };
        setUser(user);
        toast(`Welcome, ${user.name}`);
      }
      return user;
    }

    // NOTE: only returns receiver object; UI visibility handled in setTab('verify')
    function ensureReceiver(){
      return getReceiver();
    }

    // ===== Toggle handling =====
    function setTab(tab){
      const earnActive = tab === 'earn';

      // Tab button state + ARIA
      el('tabEarn').classList.toggle('active', earnActive);
      el('tabVerify').classList.toggle('active', !earnActive);
      el('tabEarn').setAttribute('aria-selected', String(earnActive));
      el('tabVerify').setAttribute('aria-selected', String(!earnActive));

      // Panel visibility
      el('panelEarn').classList.toggle('hidden', !earnActive);
      el('panelVerify').classList.toggle('hidden', earnActive);

      // Reset per-view UI
      if (earnActive){
        // Hide transient volunteer cards when switching back
        el('cardNextStep').style.display = 'none';
        el('cardAwait').style.display = 'none';
        el('cardAward').style.display = 'none';
      } else {
        // Decide which receiver sub-card to show based on login state
        const r = ensureReceiver();
        if (r){
          el('receiverLoginCard').classList.add('hidden');
          el('verifyFormCard').classList.remove('hidden');
        } else {
          el('receiverLoginCard').classList.remove('hidden');
          el('verifyFormCard').classList.add('hidden');
        }
        el('receiverThanksCard').classList.add('hidden');
      }
    }

    // ===== Volunteer Flow =====
    function submitTask(){
      const user = ensureVolunteer();
      // basic validation
      const taskName = el('taskName').value.trim();
      const location = el('location').value.trim();
      const urgent = [...document.querySelectorAll('input[name="urgent"]:checked')][0]?.value || '';
      const hours = el('hours').value;
      const summary = el('summary').value.trim();
      if(!taskName || !location){ toast('Please add task name & location'); return; }

      const draft = {
        helperId: user.id,
        helperName: user.name,
        taskName, location, urgent, hours, summary,
        status: 'draft'
      };
      store.set('draftTask', draft);

      el('cardNextStep').style.display = 'block';
      toast('Task saved. Add receiver details next.');
    }

    function submitPerson(){
      const draft = store.get('draftTask', null);
      if(!draft){ toast('Please submit task first'); return; }
      const personName = el('personName').value.trim();
      const personContact = el('personContact').value.trim();
      const helpType = el('helpType').value;
      if(!personName || !personContact){ toast('Please add person name & contact'); return; }

      const pending = {
        ...draft,
        helpType,
        personName, personContact,
        status: 'awaiting'
      };
      store.set('pendingVerification', pending);

      // also seed helperTask (for verify tab autofill)
      store.set('helperTask', {
        name: draft.helperName,
        id: draft.helperId,
        help: helpType,
        location: draft.location,
        task: draft.summary || draft.taskName
      });

      el('cardAwait').style.display = 'block';
      toast('Receiver will verify soon.');
    }

    // ===== Receiver Flow =====
    function receiverLogin(){
      const name = el('rcvName').value.trim() || 'Receiver';
      const id = el('rcvId').value.trim() || ('RCV-'+Math.floor(Math.random()*9999));
      const rec = { name, id };
      setReceiver(rec);
      el('receiverLoginCard').classList.add('hidden');
      el('verifyFormCard').classList.remove('hidden');
      toast(`Hello ${name}. You can verify now.`);

      // Autofill helper details if available
      const seed = store.get('helperTask', null);
      if(seed){
        el('helperId').value = seed.id || '';
        el('helperName').value = seed.name || '';
        el('verifyLocation').value = seed.location || '';
        el('verifyTask').value = seed.task || '';
      }
    }

    function sendVerification(isYes){
      const helperId = el('helperId').value.trim();
      const helperName = el('helperName').value.trim();
      const location = el('verifyLocation').value.trim();
      const task = el('verifyTask').value.trim();
      if(!helperId){ toast('Enter helper ID'); return; }

      const event = {
        helperId, helperName, location, task,
        status: isYes ? 'verified' : 'rejected',
        ts: Date.now()
      };
      store.set('verificationEvent', event);

      // Update receiver UI
      el('verifyFormCard').classList.add('hidden');
      el('receiverThanksCard').classList.remove('hidden');
      const ok = isYes;
      el('receiverStatus').textContent = ok? 'Status: Help verified' : 'Status: Verification declined';
      el('receiverStatus').className = 'pill ' + (ok? 'status-ok' : 'status-no');
      el('receiverMsg').textContent = ok ? 'Thanks! The helper will get a notification to accept +100 karma.' : 'Your response has been sent to the helper.';

      // Notify volunteer (in-app)
      notifyVolunteer(event);
    }

    

    function notifyVolunteer(event){
      // set a flag the volunteer screen watches
      store.set('notifForHelper', event);
      toast('Volunteer notified.');
    }

    // ===== Volunteer listens for notifications =====
    function checkNotifications(){
      const user = getUser();
      if(!user) return;
      const event = store.get('notifForHelper', null);
      if(event && event.helperId === user.id){
        // Only show once
        store.set('notifForHelper', null);
        const verified = event.status === 'verified';
        const msg = verified ? 'Your help was verified. Accept +100 karma?' : 'Your help was NOT verified.';
        if(verified){
          el('cardAward').style.display = 'block';
          el('verifyMessage').textContent = `Verified by receiver at ${new Date(event.ts).toLocaleString()}`;
          toast('Receiver verified your help.');
        } else {
          showModal('Verification Result', 'Receiver declined the verification. You may contact them politely if needed.', ()=>{}, ()=>{});
        }
      }
    }

    function acceptKarma(){
      const user = getUser();
      if(!user) return;
      user.karma = (user.karma||0) + 100;
      setUser(user);
      el('cardAward').style.display = 'none';
      el('cardAwait').style.display = 'none';
      store.set('pendingVerification', null);
      toast('+100 karma awarded!');
    }

    // ===== Quick Demo (one click walkthrough) =====
    function quickDemo(){
      // Seed volunteer & draft
      if(!getUser()) setUser({name:'Aanya Mehra', id:'SAHARA-2025-014', karma:0});
      el('taskName').value = 'Provided emergency insulin';
      el('location').value = 'Pune Station';
      document.querySelector('input[name="urgent"][value="Yes"]').checked = true;
      el('hours').value = '1-2 hours';
      el('summary').value = 'Found diabetic traveler faint; sourced insulin and stayed till ambulance arrived.';
      submitTask();
      el('personName').value = 'Ramesh Kumar';
      el('personContact').value = '+91-98XXXXXX21';
      el('helpType').value = 'Medical Aid';
      submitPerson();

      // Switch to receiver, verify YES, then back to earn to accept karma
      setTab('verify');
      el('rcvName').value = 'Ramesh Kumar';
      el('rcvId').value = 'RCV-1001';
      receiverLogin();
      sendVerification(true);
      setTab('earn');
      checkNotifications();
    }

    // ===== Event wiring =====
    document.addEventListener('DOMContentLoaded', ()=>{
      // Initialize profiles
      renderVolunteerProfile();

      // Tabs
      el('tabEarn').onclick = ()=> setTab('earn');
      el('tabVerify').onclick = ()=> setTab('verify');

      // Volunteer actions
      el('btnSubmitTask').onclick = submitTask;
      el('btnSubmitPerson').onclick = submitPerson;
      el('btnAcceptKarma').onclick = acceptKarma;
      el('btnLater').onclick = ()=>{ el('cardAward').style.display='none'; toast('You can accept later.'); };

      // Receiver actions
      el('btnReceiverLogin').onclick = receiverLogin;
      el('btnConfirmYes').onclick = ()=> sendVerification(true);
      el('btnConfirmNo').onclick = ()=> sendVerification(false);

      // Account switching
      el('switchAccountBtn').onclick = ()=>{
        showModal('Switch Volunteer', 'This clears the current volunteer session for demo.', ()=>{
          localStorage.removeItem('user');
          renderVolunteerProfile();
          toast('Volunteer cleared.');
          // refresh current view
          const earnActive = !el('panelEarn').classList.contains('hidden');
          setTab(earnActive ? 'earn' : 'verify');
        }, ()=>{});
      };
      el('switchReceiverBtn').onclick = ()=>{
        showModal('Switch Receiver', 'This clears the current receiver session for demo.', ()=>{
          localStorage.removeItem('receiver');
          toast('Receiver cleared.');
          // If currently on verify, refresh that view to show login
          const verifyActive = !el('panelVerify').classList.contains('hidden');
          if (verifyActive) setTab('verify');
        }, ()=>{});
      };

      // Quick demo
      el('quickDemoBtn').onclick = quickDemo;

      // Poll for notifications (demo-only)
      setInterval(checkNotifications, 1200);

      // Default to Earn tab on load
      setTab('earn');

      // Restore awaiting state if present
      const pending = store.get('pendingVerification', null);
      if(pending && pending.status==='awaiting'){
        el('cardNextStep').style.display = 'none';
        el('cardAwait').style.display = 'block';
      }
    });
  </script>
</body>
</html>
